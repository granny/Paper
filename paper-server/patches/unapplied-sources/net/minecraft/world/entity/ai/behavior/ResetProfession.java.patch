From 8970c8040a87bb9da1d22cabfd5dafb79924ed1f Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/entity/ai/behavior/ResetProfession.java b/net/minecraft/world/entity/ai/behavior/ResetProfession.java
index 260ce42b833f740d768503e8be1bd455c974d882..9734caf329c762c8daa887324e42f8613bd16dad 100644
--- a/net/minecraft/world/entity/ai/behavior/ResetProfession.java
+++ b/net/minecraft/world/entity/ai/behavior/ResetProfession.java
@@ -13,7 +13,14 @@ public class ResetProfession {
                 VillagerData villagerData = villager.getVillagerData();
                 boolean flag = !villagerData.profession().is(VillagerProfession.NONE) && !villagerData.profession().is(VillagerProfession.NITWIT);
                 if (flag && villager.getVillagerXp() == 0 && villagerData.level() <= 1) {
-                    villager.setVillagerData(villager.getVillagerData().withProfession(level.registryAccess(), VillagerProfession.NONE));
+                    // CraftBukkit start
+                    org.bukkit.event.entity.VillagerCareerChangeEvent event = org.bukkit.craftbukkit.event.CraftEventFactory.callVillagerCareerChangeEvent(villager, org.bukkit.craftbukkit.entity.CraftVillager.CraftProfession.minecraftHolderToBukkit(level.registryAccess().getOrThrow(VillagerProfession.NONE)), org.bukkit.event.entity.VillagerCareerChangeEvent.ChangeReason.LOSING_JOB);
+                    if (event.isCancelled()) {
+                        return false;
+                    }
+
+                    villager.setVillagerData(villager.getVillagerData().withProfession(org.bukkit.craftbukkit.entity.CraftVillager.CraftProfession.bukkitToMinecraftHolder(event.getProfession())));
+                    // CraftBukkit end
                     villager.refreshBrain(level);
                     return true;
                 } else {
