From 8970c8040a87bb9da1d22cabfd5dafb79924ed1f Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/level/block/CactusBlock.java b/net/minecraft/world/level/block/CactusBlock.java
index 2aab5400009dad508d1f7b7ad508487765d61466..8f6878cc8e72513446895bfc79886075bfcd5565 100644
--- a/net/minecraft/world/level/block/CactusBlock.java
+++ b/net/minecraft/world/level/block/CactusBlock.java
@@ -58,25 +58,29 @@ public class CactusBlock extends Block {
             int ageValue = state.getValue(AGE);
 
             while (level.getBlockState(pos.below(i)).is(this)) {
-                if (++i == 3 && ageValue == 15) {
+                if (++i == level.paperConfig().maxGrowthHeight.cactus && ageValue == 15) { // Paper - Configurable cactus/bamboo/reed growth height
                     return;
                 }
             }
 
             if (ageValue == 8 && this.canSurvive(this.defaultBlockState(), level, pos.above())) {
-                double d = i >= 3 ? 0.25 : 0.1;
+                double d = i >= level.paperConfig().maxGrowthHeight.cactus ? 0.25 : 0.1; // Paper - Configurable cactus/bamboo/reed growth height
                 if (random.nextDouble() <= d) {
-                    level.setBlockAndUpdate(blockPos, Blocks.CACTUS_FLOWER.defaultBlockState());
+                    org.bukkit.craftbukkit.event.CraftEventFactory.handleBlockGrowEvent(level, blockPos, Blocks.CACTUS_FLOWER.defaultBlockState(), 3);
                 }
-            } else if (ageValue == 15 && i < 3) {
-                level.setBlockAndUpdate(blockPos, this.defaultBlockState());
+            } else if (ageValue == 15 && i < level.paperConfig().maxGrowthHeight.cactus) { // Paper - Configurable cactus/bamboo/reed growth height
+                // Paper start
+                if (!org.bukkit.craftbukkit.event.CraftEventFactory.handleBlockGrowEvent(level, blockPos, this.defaultBlockState(), 3)) {
+                    return;
+                }
+                // Paper end
                 BlockState blockState = state.setValue(AGE, 0);
                 level.setBlock(pos, blockState, 260);
                 level.neighborChanged(blockState, blockPos, this, null, false);
             }
 
             if (ageValue < 15) {
-                level.setBlock(pos, state.setValue(AGE, ageValue + 1), 260);
+                org.bukkit.craftbukkit.event.CraftEventFactory.handleBlockGrowEvent(level, pos, state.setValue(AGE, ageValue + 1), 260); // Paper
             }
         }
     }
@@ -124,7 +128,8 @@ public class CactusBlock extends Block {
 
     @Override
     protected void entityInside(BlockState state, Level level, BlockPos pos, Entity entity, InsideBlockEffectApplier effectApplier) {
-        entity.hurt(level.damageSources().cactus(), 1.0F);
+        if (!new io.papermc.paper.event.entity.EntityInsideBlockEvent(entity.getBukkitEntity(), org.bukkit.craftbukkit.block.CraftBlock.at(level, pos)).callEvent()) { return; } // Paper - Add EntityInsideBlockEvent
+        entity.hurt(level.damageSources().cactus().eventBlockDamager(level, pos), 1.0F); // CraftBukkit
     }
 
     @Override
