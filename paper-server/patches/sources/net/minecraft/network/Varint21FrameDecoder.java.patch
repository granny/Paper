From 8970c8040a87bb9da1d22cabfd5dafb79924ed1f Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/network/Varint21FrameDecoder.java b/net/minecraft/network/Varint21FrameDecoder.java
index 747ab731774753f7a25959a2f7b84cf589b2931a..505d4b04e38dbe95c53e15b355a07cd58d6f981e 100644
--- a/net/minecraft/network/Varint21FrameDecoder.java
+++ b/net/minecraft/network/Varint21FrameDecoder.java
@@ -41,6 +41,12 @@ public class Varint21FrameDecoder extends ByteToMessageDecoder {
 
     @Override
     protected void decode(ChannelHandlerContext context, ByteBuf in, List<Object> out) {
+        // Paper start - Perf: Optimize exception handling; if channel is not active just discard the packet
+        if (!context.channel().isActive()) {
+            in.skipBytes(in.readableBytes());
+            return;
+        }
+        // Paper end - Perf: Optimize exception handling
         in.markReaderIndex();
         this.helperBuf.clear();
         if (!copyVarint(in, this.helperBuf)) {
